# 要件定義書

## ドキュメント情報

| 項目           | 内容                                      |
| -------------- | ----------------------------------------- |
| プロジェクト名 | Darts App（ダーツセッティング管理アプリ） |
| バージョン     | 1.0                                       |
| 作成者         | Webエンジニア                             |
| 作成日         | 2025-02-09                                |
| 最終更新日     | 2025-02-09                                |

---

## 1. 背景・目的

### 1.1 背景

ダーツプレイヤーにとって、自身のセッティング（バレル・シャフト・フライト・チップの組み合わせ）の管理や、練習スタッツの記録・可視化は日常的なニーズである。しかし、以下の課題が存在する。

- **セッティング管理が分散している**: 写真やメモで断片的に記録しており、過去のセッティングを振り返りにくい
- **スタッツの記録が手間**: DARTSLIVE公式アプリでは過去データの推移比較が限定的で、自分の成長を俯瞰しにくい
- **バレル選びの情報が分散**: スペック比較をするために複数のECサイトを横断する必要がある
- **セッティング共有の場がない**: 他プレイヤーのセッティングを参考にしたくても、体系的に閲覧できるプラットフォームが少ない

### 1.2 目的

上記課題を解決する **ダーツセッティング管理・スタッツ記録・コミュニティWebアプリケーション** を開発する。

本プロジェクトは以下の2つの目的を持つ。

1. **実用ツール**: 自身を含むダーツプレイヤーが日常的に使えるアプリケーション
2. **技術ポートフォリオ**: Webエンジニアとしての設計力・実装力を示す成果物

---

## 2. ユーザー定義

### 2.1 ユーザー種別

| 種別                    | 説明                             | 権限                                                         |
| ----------------------- | -------------------------------- | ------------------------------------------------------------ |
| 一般ユーザー（general） | アプリに登録したダーツプレイヤー | セッティング登録・閲覧・コメント・ブックマーク・スタッツ記録 |
| プロユーザー（pro）     | 運営が認定した上級者             | 一般権限 + 記事投稿・公開                                    |
| 管理者（admin）         | アプリ運営者                     | 全権限 + ユーザーロール管理                                  |
| 未ログインユーザー      | 未認証の閲覧者                   | セッティング・バレル・記事の閲覧のみ                         |

### 2.2 ペルソナ

| ペルソナ        | 属性                | 主な利用シーン                                           |
| --------------- | ------------------- | -------------------------------------------------------- |
| Aさん（初心者） | ダーツ歴3ヶ月、Rt.3 | 他人のセッティングを参考にしたい、自分の成長を記録したい |
| Bさん（中級者） | ダーツ歴2年、Rt.8   | バレル買い替え検討、スタッツ推移の分析                   |
| Cさん（上級者） | ダーツ歴5年、Rt.14  | セッティング情報の発信、記事執筆                         |

---

## 3. 機能一覧

### 3.1 機能概要図

```
Darts App
├── 認証・ユーザー管理
│   ├── メール/パスワード認証
│   ├── Google OAuth認証
│   ├── プロフィール編集
│   └── ロール管理（admin）
├── セッティング管理
│   ├── セッティング登録（バレル・シャフト・フライト・チップ）
│   ├── セッティング一覧・検索・フィルタ
│   ├── セッティング詳細閲覧
│   ├── セッティング編集・削除
│   ├── セッティング比較（2つを並べて比較）
│   ├── いいね・ブックマーク
│   └── コメント
├── バレルデータベース
│   ├── バレル検索（ブランド・重量・径・長さ・カット）
│   ├── バレルブックマーク
│   └── バレルからセッティング下書き作成
├── スタッツ記録
│   ├── DARTSLIVE連携（Webスクレイピング）
│   ├── 手動スタッツ入力
│   ├── 月間推移グラフ（Rating/01/Cricket/COUNT-UP）
│   ├── 直近プレイデータ表示
│   └── 前回比較（±表示）
├── 記事
│   ├── Markdown記事投稿（pro/admin）
│   ├── 記事一覧・閲覧
│   └── 記事編集・削除
├── リファレンス
│   └── シャフトスペック早見表
└── 管理機能
    └── ユーザーロール管理
```

### 3.2 機能詳細

#### F-001: ユーザー認証

| 項目         | 内容                                            |
| ------------ | ----------------------------------------------- |
| 概要         | メール/パスワードおよびGoogleアカウントでの認証 |
| 認証方式     | Firebase Authentication + NextAuth.js（JWT）    |
| 対象ユーザー | 全ユーザー                                      |
| 画面         | `/login`, `/register`                           |

#### F-002: プロフィール管理

| 項目               | 内容                                                                      |
| ------------------ | ------------------------------------------------------------------------- |
| 概要               | 表示名・アバター・身長・4スタンス理論タイプ・利き目・グリップタイプの編集 |
| 使用中セッティング | ソフト/スティール各1本を「使用中ダーツ」として設定可能                    |
| 画面               | `/profile/edit`                                                           |

#### F-003: セッティング登録・管理

| 項目             | 内容                                                 |
| ---------------- | ---------------------------------------------------- |
| 概要             | バレル・チップ・シャフト・フライトの組み合わせを登録 |
| 入力方式         | プリセット選択（主要メーカー製品）+ カスタム入力     |
| 画像             | 最大3枚アップロード（Firebase Storage）              |
| 下書き機能       | 非公開で保存可能                                     |
| スペック自動計算 | パーツの重量・全長を合算表示                         |
| 特殊対応         | CONDOR AXE（一体型フライト+シャフト）の専用入力      |
| 画面             | `/darts/new`, `/darts/[id]/edit`                     |

#### F-004: セッティング一覧・検索

| 項目         | 内容                                         |
| ------------ | -------------------------------------------- |
| 概要         | 全ユーザーのセッティングを一覧表示           |
| フィルタ     | ブランド・カット・種別（ソフト/スティール）  |
| テキスト検索 | タイトル・ユーザー名で検索                   |
| おすすめ     | ユーザーの登録傾向から類似バレルをレコメンド |
| 画面         | `/darts`                                     |

#### F-005: セッティング比較

| 項目     | 内容                                         |
| -------- | -------------------------------------------- |
| 概要     | 2つのセッティングを横並びでスペック比較      |
| 比較項目 | 重量・全長・各パーツ寸法（差分をカラー表示） |
| 画面     | `/darts/compare`                             |

#### F-006: ソーシャル機能（いいね・コメント・ブックマーク）

| 項目         | 内容                                           |
| ------------ | ---------------------------------------------- |
| 概要         | セッティングへのいいね・コメント・ブックマーク |
| 対象ユーザー | ログインユーザー                               |
| 画面         | `/darts/[id]`, `/bookmarks`                    |

#### F-007: バレルデータベース

| 項目             | 内容                                       |
| ---------------- | ------------------------------------------ |
| 概要             | バレル製品のスペック検索・比較             |
| データソース     | 外部ECサイトからのインポート（スクリプト） |
| フィルタ         | ブランド・重量・最大径・全長・カットタイプ |
| ページネーション | 30件/ページ                                |
| 画面             | `/barrels`                                 |

#### F-008: DARTSLIVE スタッツ連携

| 項目         | 内容                                                                          |
| ------------ | ----------------------------------------------------------------------------- |
| 概要         | DARTSLIVEアカウントからスタッツを自動取得                                     |
| 取得方式     | サーバーサイドWebスクレイピング（Puppeteer）                                  |
| 取得データ   | Rating, 01平均, Cricket平均, COUNT-UP平均, Awards, 月間推移, 直近プレイデータ |
| データ保存   | Firestoreにキャッシュ（前回値との差分表示用）                                 |
| セキュリティ | 認証情報はサーバー上で一時利用のみ（保存しない）                              |
| 画面         | `/stats`                                                                      |

#### F-009: スタッツ手動入力

| 項目     | 内容                                                                                                              |
| -------- | ----------------------------------------------------------------------------------------------------------------- |
| 概要     | Rating, PPD, MPR等を手動で記録                                                                                    |
| 入力項目 | 日付, Rating, ゲーム数, PPD, アベレージ, ハイオフ, MPR, ハイスコア, ブル率, ハットトリック数, 調子（5段階）, メモ |
| 画面     | `/stats/new`, `/stats/[id]/edit`                                                                                  |

#### F-010: 記事投稿

| 項目         | 内容                                                                      |
| ------------ | ------------------------------------------------------------------------- |
| 概要         | Markdownベースのナレッジ記事投稿                                          |
| 対象ユーザー | pro, admin                                                                |
| 機能         | GFM対応, カバー画像, タグ, 下書き/公開, 注目記事フラグ                    |
| 画面         | `/articles`, `/articles/new`, `/articles/[slug]`, `/articles/[slug]/edit` |

#### F-011: リファレンス

| 項目 | 内容                   |
| ---- | ---------------------- |
| 概要 | シャフトスペック早見表 |
| 画面 | `/reference`           |

#### F-012: 管理機能

| 項目         | 内容                                      |
| ------------ | ----------------------------------------- |
| 概要         | ユーザーロール（admin/pro/general）の変更 |
| 対象ユーザー | admin                                     |
| 画面         | `/admin/users`                            |

---

## 4. 非機能要件

### 4.1 パフォーマンス

| 項目       | 要件                                                     |
| ---------- | -------------------------------------------------------- |
| 初期表示   | FCP 2秒以内（Vercel CDN利用）                            |
| ページ遷移 | Next.js App Routerによるクライアントサイドナビゲーション |
| 画像最適化 | Next.js Image + Firebase Storage                         |

### 4.2 セキュリティ

| 項目          | 要件                                                       |
| ------------- | ---------------------------------------------------------- |
| 認証          | Firebase Auth + NextAuth.js JWT                            |
| 認可          | Firestoreセキュリティルール + サーバーサイドロールチェック |
| 秘密情報      | 環境変数で管理、フロントエンドに秘密鍵を埋め込まない       |
| DARTSLIVE連携 | 認証情報は一時利用のみ、サーバーメモリ上で処理後破棄       |
| CORS          | Firebase Storage のCORS設定、画像プロキシAPI               |
| 入力検証      | クライアント・サーバー両方でバリデーション                 |

### 4.3 可用性

| 項目         | 要件                              |
| ------------ | --------------------------------- |
| ホスティング | Vercel（自動スケーリング）        |
| データベース | Firebase Firestore（SLA 99.999%） |
| 障害時       | Vercelの自動リカバリに依存        |

### 4.4 運用・保守

| 項目     | 要件                                  |
| -------- | ------------------------------------- |
| デプロイ | GitHub連携によるVercel自動デプロイ    |
| 環境分離 | 環境変数による開発/本番切り替え       |
| ログ     | Vercel Functions ログ + console.error |

---

## 5. 制約事項

| 項目                | 内容                                                                                          |
| ------------------- | --------------------------------------------------------------------------------------------- |
| DARTSLIVE API       | 公式APIが存在しないため、Webスクレイピングで代替。サイト構造変更時は修正が必要                |
| バレルデータ        | 外部サイトからの初期インポート。リアルタイム同期ではない                                      |
| Puppeteer on Vercel | Vercel Serverless Functionsの制約（メモリ・実行時間）により、スクレイピングの安定性に限界あり |
| 個人開発            | 1名での開発・運用のため、サポート体制は限定的                                                 |

---

## 6. 用語定義

| 用語             | 説明                                                             |
| ---------------- | ---------------------------------------------------------------- |
| バレル           | ダーツの金属製グリップ部分。重量・径・長さ・カットが主なスペック |
| シャフト         | バレルとフライトを繋ぐ棒状のパーツ                               |
| フライト         | ダーツ後部の羽。形状により飛び方が変わる                         |
| チップ           | ダーツ先端のポイント部分。ソフトダーツはプラスチック製           |
| Rating           | DARTSLIVEにおける総合実力指標                                    |
| PPD              | Points Per Dart。01ゲームの平均得点                              |
| MPR              | Marks Per Round。クリケットの1ラウンドあたりマーク数             |
| フライト（階級） | DARTSLIVEのレーティングに応じた階級（C〜SA）                     |
| CONDOR AXE       | シャフトとフライトが一体型のパーツ（特殊入力対応）               |
| 4スタンス理論    | 重心タイプ（A1/A2/B1/B2）に基づく身体理論                        |
