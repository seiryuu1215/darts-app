# 要件定義書

## ドキュメント情報

| 項目           | 内容                                        |
| -------------- | ------------------------------------------- |
| プロジェクト名 | Darts Lab（ダーツ総合管理プラットフォーム） |
| バージョン     | 3.0                                         |
| 作成者         | Webエンジニア                               |
| 作成日         | 2025-02-09                                  |
| 最終更新日     | 2026-02-23                                  |

---

## 1. 背景・目的

### 1.1 背景

ダーツプレイヤーにとって、自身のセッティング（バレル・シャフト・フライト・チップの組み合わせ）の管理や、練習スタッツの記録・可視化は日常的なニーズである。しかし、以下の課題が存在する。

- **セッティング管理が分散している**: 写真やメモで断片的に記録しており、過去のセッティングを振り返りにくい
- **スタッツの記録が手間**: DARTSLIVE公式アプリでは過去データの推移比較が限定的で、自分の成長を俯瞰しにくい
- **練習の成長を客観的に分析する手段がない**: レーティング推移だけでは把握できないスキルの偏りや改善ポイントを可視化する仕組みが求められている
- **バレル選びの情報が分散**: スペック比較をするために複数のECサイトを横断する必要がある
- **ショップ管理が断片的**: ダーツショップの情報が散在しており、訪問済み/未訪問の管理やお気に入り店舗の整理が難しい
- **セッティング共有の場がない**: 他プレイヤーのセッティングを参考にしたくても、体系的に閲覧できるプラットフォームが少ない

### 1.2 目的

上記課題を解決する **ダーツ総合管理プラットフォーム** を開発する。

本プロジェクトは以下の2つの目的を持つ。

1. **実用ツール**: 自身を含むダーツプレイヤーが日常的に使えるアプリケーション
2. **技術ポートフォリオ**: Webエンジニアとしての設計力・実装力を示す成果物

---

## 2. ユーザー定義

### 2.1 ユーザー種別

| 種別                    | 説明                             | 権限                                                         |
| ----------------------- | -------------------------------- | ------------------------------------------------------------ |
| 一般ユーザー（general） | アプリに登録したダーツプレイヤー | セッティング登録・閲覧・コメント・ブックマーク・スタッツ記録 |
| プロユーザー（pro）     | 運営が認定した上級者             | 一般権限 + 記事投稿・公開                                    |
| 管理者（admin）         | アプリ運営者                     | 全権限 + ユーザーロール管理                                  |
| 未ログインユーザー      | 未認証の閲覧者                   | セッティング・バレル・記事の閲覧のみ                         |

### 2.2 ペルソナ

| ペルソナ        | 属性                | 主な利用シーン                                           |
| --------------- | ------------------- | -------------------------------------------------------- |
| Aさん（初心者） | ダーツ歴3ヶ月、Rt.3 | 他人のセッティングを参考にしたい、自分の成長を記録したい |
| Bさん（中級者） | ダーツ歴2年、Rt.8   | バレル買い替え検討、スタッツ推移の分析                   |
| Cさん（上級者） | ダーツ歴5年、Rt.14  | セッティング情報の発信、記事執筆                         |

---

## 3. 機能一覧

### 3.1 機能概要図

```
Darts Lab
├── 認証・ユーザー管理
│   ├── メール/パスワード認証
│   ├── Google OAuth認証
│   ├── パスワードリセット
│   ├── プロフィール編集
│   └── ロール管理（admin）
├── セッティング管理
│   ├── セッティング登録（バレル・シャフト・フライト・チップ）
│   ├── セッティング一覧・検索・フィルタ
│   ├── セッティング詳細閲覧
│   ├── セッティング編集・削除
│   ├── セッティング比較（2つを並べて比較）
│   ├── セッティング使用履歴
│   ├── いいね・ブックマーク
│   └── コメント
├── バレルデータベース
│   ├── バレル検索（ブランド・重量・径・長さ・カット）
│   ├── バレルブックマーク
│   ├── バレルからセッティング下書き作成
│   ├── バレルシミュレーター
│   ├── バレル診断クイズ
│   └── おすすめバレル
├── スタッツ記録
│   ├── DARTSLIVEアカウント連携（自動データ取得）
│   ├── 手動スタッツ入力
│   ├── スキル分析
│   │   ├── レーダーチャート（フライト別ベンチマーク比較対応）
│   │   ├── 簡易スキルレーダー（PRO: 01/Cricket/CU/D-Bull率/安定性の5軸）
│   │   ├── プレイヤーDNA
│   │   └── パフォーマンスインサイト
│   ├── ゲーム詳細
│   │   ├── 詳細ゲームスタッツ
│   │   ├── レーティングベンチマーク
│   │   └── レーティングシミュレーター
│   ├── 推移・履歴
│   │   ├── 移動平均トレンド
│   │   ├── 期間比較
│   │   ├── 連勝パターン
│   │   └── アワードペース
│   ├── ゲーム分析
│   │   ├── COUNT-UP深掘り分析
│   │   ├── ラウンド分析
│   │   ├── ダーツボードヒートマップ
│   │   └── セッション疲労分析
│   ├── センサー分析
│   │   ├── センサー推移
│   │   └── スピード精度
│   ├── トレンド分析
│   │   ├── レーティングトレンドスパークライン（回帰直線付き）
│   │   ├── ゲーム安定度・連続分析（CV/連勝ラン）
│   │   ├── COUNT-UP Rt期待値以上率・前後半トレンド
│   │   └── セッション比較（直近2回のプレイ日を自動比較）
│   ├── AI練習レコメンデーション
│   ├── コンポーネント単位の表示/非表示トグル（localStorage保持）
│   └── 前回比較（±表示）
├── スタッツカレンダー
│   └── カレンダー形式でのプレイ履歴表示
├── ショップ管理
│   ├── ブックマーク（お気に入り・リスト分類・タグ・メモ・評価）
│   ├── 路線フィルター（路線名・カラー定義）
│   ├── 訪問済み/未訪問フィルター + 訪問済みバッジ
│   ├── 禁煙/分煙フィルター
│   └── タグフィルター
├── ディスカッション（掲示板）
│   ├── スレッド作成・一覧・検索
│   └── コメント・返信
├── LINE Messaging API連携
│   ├── LINEアカウント連携
│   ├── 日次スタッツ通知
│   └── コンディション記録
├── Stripe決済
│   ├── PROプラン（サブスクリプション）
│   └── プラン管理・決済履歴
├── XP/レベル/ランクシステム
│   └── アクティビティに応じた経験値・レベルアップ
├── 目標管理
│   └── レーティング目標設定・進捗追跡
├── 通知システム
│   └── アプリ内通知・プッシュ通知
├── PWA対応
│   └── オフライン対応・ホーム画面追加
├── iOSネイティブアプリ（Capacitor）
│   └── iOS向けネイティブラッパー
├── 記事
│   ├── Markdown記事投稿（pro/admin）
│   ├── 記事一覧・閲覧
│   └── 記事編集・削除
├── リファレンス
│   └── シャフトスペック早見表
└── 管理機能
    ├── ユーザーロール管理
    └── 料金プラン管理
```

### 3.2 機能詳細

#### F-001: ユーザー認証

| 項目         | 内容                                                     |
| ------------ | -------------------------------------------------------- |
| 概要         | メール/パスワードおよびGoogleアカウントでの認証          |
| 認証方式     | Firebase Authentication + NextAuth.js（JWT）             |
| パスワード   | パスワードリセット機能（メール送信によるリセットフロー） |
| 対象ユーザー | 全ユーザー                                               |
| 画面         | `/login`, `/register`, `/forgot-password`                |

#### F-002: プロフィール管理

| 項目               | 内容                                                                      |
| ------------------ | ------------------------------------------------------------------------- |
| 概要               | 表示名・アバター・身長・4スタンス理論タイプ・利き目・グリップタイプの編集 |
| 使用中セッティング | ソフト/スティール各1本を「使用中ダーツ」として設定可能                    |
| 画面               | `/profile/edit`                                                           |

#### F-003: セッティング登録・管理

| 項目             | 内容                                                 |
| ---------------- | ---------------------------------------------------- |
| 概要             | バレル・チップ・シャフト・フライトの組み合わせを登録 |
| 入力方式         | プリセット選択（主要メーカー製品）+ カスタム入力     |
| 画像             | 最大3枚アップロード（Firebase Storage）              |
| 下書き機能       | 非公開で保存可能                                     |
| スペック自動計算 | パーツの重量・全長を合算表示                         |
| 使用履歴         | セッティングの使用開始・終了を記録し履歴管理         |
| 特殊対応         | CONDOR AXE（一体型フライト+シャフト）の専用入力      |
| 画面             | `/darts/new`, `/darts/[id]/edit`, `/darts/history`   |

#### F-004: セッティング一覧・検索

| 項目         | 内容                                         |
| ------------ | -------------------------------------------- |
| 概要         | 全ユーザーのセッティングを一覧表示           |
| フィルタ     | ブランド・カット・種別（ソフト/スティール）  |
| テキスト検索 | タイトル・ユーザー名で検索                   |
| おすすめ     | ユーザーの登録傾向から類似バレルをレコメンド |
| 画面         | `/darts`                                     |

#### F-005: セッティング比較

| 項目     | 内容                                         |
| -------- | -------------------------------------------- |
| 概要     | 2つのセッティングを横並びでスペック比較      |
| 比較項目 | 重量・全長・各パーツ寸法（差分をカラー表示） |
| 画面     | `/darts/compare`                             |

#### F-006: ソーシャル機能（いいね・コメント・ブックマーク）

| 項目         | 内容                                           |
| ------------ | ---------------------------------------------- |
| 概要         | セッティングへのいいね・コメント・ブックマーク |
| 対象ユーザー | ログインユーザー                               |
| 画面         | `/darts/[id]`, `/bookmarks`                    |

#### F-007: バレルデータベース

| 項目                 | 内容                                                                    |
| -------------------- | ----------------------------------------------------------------------- |
| 概要                 | バレル製品のスペック検索・比較                                          |
| データソース         | 外部ECサイトからのインポート（スクリプト）                              |
| フィルタ             | ブランド・重量・最大径・全長・カットタイプ                              |
| バレルシミュレーター | バレルのスペックを可視化・比較シミュレーション                          |
| バレル診断クイズ     | 質問に回答して自分に合ったバレルを診断                                  |
| おすすめバレル       | 使用傾向やプロフィールに基づくバレル提案                                |
| ページネーション     | 30件/ページ                                                             |
| 画面                 | `/barrels`, `/barrels/simulator`, `/barrels/quiz`, `/barrels/recommend` |

#### F-008: DARTSLIVEアカウント連携

| 項目         | 内容                                                                          |
| ------------ | ----------------------------------------------------------------------------- |
| 概要         | DARTSLIVEアカウントとの連携によりスタッツを自動取得                           |
| 取得方式     | サーバーサイド自動データ取得（サーバーサイドブラウザ自動化）                  |
| 取得データ   | Rating, 01平均, Cricket平均, COUNT-UP平均, Awards, 月間推移, 直近プレイデータ |
| データ保存   | Firestoreにキャッシュ（前回値との差分表示用）                                 |
| セキュリティ | 認証情報はサーバー上で一時利用のみ（保存しない）、処理完了後に即時破棄        |
| 画面         | `/stats`                                                                      |

#### F-009: スタッツ詳細分析

| 項目                     | 内容                                                                           |
| ------------------------ | ------------------------------------------------------------------------------ |
| 概要                     | API連携で取得したスタッツデータの多角的分析                                    |
| スキル分析               | レーダーチャート、プレイヤーDNA、パフォーマンスインサイト                      |
| ゲーム詳細               | 詳細ゲームスタッツ、レーティングベンチマーク、レーティングシミュレーター       |
| 推移・履歴               | 移動平均トレンド、期間比較、連勝パターン、アワードペース                       |
| ゲーム分析               | COUNT-UP深掘り分析、ラウンド分析、ダーツボードヒートマップ、セッション疲労分析 |
| センサー分析             | センサー推移、スピード精度                                                     |
| AI練習レコメンデーション | スタッツに基づく練習メニューの提案                                             |
| 表示カスタマイズ         | コンポーネント単位の表示/非表示トグル（localStorage保持）                      |
| 画面                     | `/stats`                                                                       |

#### F-010: スタッツ手動入力

| 項目     | 内容                                                                                                              |
| -------- | ----------------------------------------------------------------------------------------------------------------- |
| 概要     | Rating, PPD, MPR等を手動で記録                                                                                    |
| 入力項目 | 日付, Rating, ゲーム数, PPD, アベレージ, ハイオフ, MPR, ハイスコア, ブル率, ハットトリック数, 調子（5段階）, メモ |
| 画面     | `/stats/new`, `/stats/[id]/edit`                                                                                  |

#### F-011: スタッツカレンダー

| 項目     | 内容                                                     |
| -------- | -------------------------------------------------------- |
| 概要     | カレンダー形式でプレイ履歴を表示・振り返り               |
| 表示内容 | 日ごとのプレイ回数、レーティング推移をカレンダー上に表示 |
| 画面     | `/stats/calendar`                                        |

#### F-012: ショップ管理

| 項目           | 内容                                                 |
| -------------- | ---------------------------------------------------- |
| 概要           | ダーツショップの検索・ブックマーク・訪問管理         |
| ブックマーク   | お気に入り登録・リスト分類・タグ・メモ・評価         |
| 路線フィルター | 路線名・カラー定義による絞り込み                     |
| 訪問管理       | 訪問済み/未訪問フィルター + カード上の訪問済みバッジ |
| 環境フィルター | 禁煙/分煙フィルター                                  |
| タグフィルター | ユーザー定義タグによる絞り込み                       |
| 画面           | `/shops`                                             |

#### F-013: ディスカッション（掲示板）

| 項目         | 内容                                                    |
| ------------ | ------------------------------------------------------- |
| 概要         | ダーツに関するスレッド形式の掲示板                      |
| 機能         | スレッド作成・一覧・検索、コメント・返信                |
| 対象ユーザー | ログインユーザー                                        |
| 画面         | `/discussions`, `/discussions/new`, `/discussions/[id]` |

#### F-014: LINE Messaging API連携

| 項目               | 内容                                                   |
| ------------------ | ------------------------------------------------------ |
| 概要               | LINEアカウントとの連携による通知・記録機能             |
| アカウント連携     | LINEアカウントとアプリアカウントの紐付け               |
| 日次通知           | スタッツサマリーの日次LINE通知                         |
| コンディション記録 | LINEメッセージによるコンディション（体調・調子）の記録 |
| 対象ユーザー       | ログインユーザー                                       |

#### F-015: Stripe決済

| 項目     | 内容                                |
| -------- | ----------------------------------- |
| 概要     | PROプランのサブスクリプション決済   |
| 決済方式 | Stripe Checkout + Webhook           |
| プラン   | FREE / PROの2プラン構成             |
| 管理機能 | プラン変更・解約・決済履歴の確認    |
| 画面     | `/pricing`, `/profile/subscription` |

#### F-016: XP/レベル/ランクシステム

| 項目   | 内容                                                   |
| ------ | ------------------------------------------------------ |
| 概要   | アクティビティに応じた経験値付与・レベルアップシステム |
| XP獲得 | スタッツ記録、セッティング登録、コメント等でXP獲得     |
| レベル | 累計XPに応じたレベル表示                               |
| ランク | レベルに応じたランク称号の付与                         |

#### F-017: 目標管理

| 項目 | 内容                                       |
| ---- | ------------------------------------------ |
| 概要 | レーティング目標の設定と進捗追跡           |
| 機能 | 目標値設定、現在値との差分表示、進捗グラフ |

#### F-018: 通知システム

| 項目     | 内容                                     |
| -------- | ---------------------------------------- |
| 概要     | アプリ内通知およびプッシュ通知           |
| 通知種別 | コメント、いいね、フォロー、システム通知 |

#### F-019: PWA対応

| 項目 | 内容                               |
| ---- | ---------------------------------- |
| 概要 | Progressive Web Appとしての動作    |
| 機能 | オフライン対応、ホーム画面への追加 |

#### F-020: iOSネイティブアプリ（Capacitor）

| 項目 | 内容                                         |
| ---- | -------------------------------------------- |
| 概要 | Capacitorを使用したiOS向けネイティブラッパー |
| 機能 | プッシュ通知、ネイティブUI統合               |

#### F-021: 記事投稿

| 項目         | 内容                                                                      |
| ------------ | ------------------------------------------------------------------------- |
| 概要         | Markdownベースのナレッジ記事投稿                                          |
| 対象ユーザー | pro, admin                                                                |
| 機能         | GFM対応, カバー画像, タグ, 下書き/公開, 注目記事フラグ                    |
| 画面         | `/articles`, `/articles/new`, `/articles/[slug]`, `/articles/[slug]/edit` |

#### F-022: リファレンス

| 項目 | 内容                   |
| ---- | ---------------------- |
| 概要 | シャフトスペック早見表 |
| 画面 | `/reference`           |

#### F-023: 管理機能

| 項目         | 内容                                      |
| ------------ | ----------------------------------------- |
| 概要         | ユーザーロール管理および料金プラン管理    |
| ロール管理   | ユーザーロール（admin/pro/general）の変更 |
| 料金プラン   | FREE/PROプランの設定・管理                |
| 対象ユーザー | admin                                     |
| 画面         | `/admin/users`, `/admin/pricing`          |

---

## 4. 非機能要件

### 4.1 パフォーマンス

| 項目       | 要件                                                     |
| ---------- | -------------------------------------------------------- |
| 初期表示   | FCP 2秒以内（Vercel CDN利用）                            |
| ページ遷移 | Next.js App Routerによるクライアントサイドナビゲーション |
| 画像最適化 | Next.js Image + Firebase Storage                         |

### 4.2 セキュリティ

| 項目           | 要件                                                       |
| -------------- | ---------------------------------------------------------- |
| 認証           | Firebase Auth + NextAuth.js JWT                            |
| 認可           | Firestoreセキュリティルール + サーバーサイドロールチェック |
| 秘密情報       | 環境変数で管理、フロントエンドに秘密鍵を埋め込まない       |
| DARTSLIVE連携  | 認証情報は一時利用のみ、サーバーメモリ上で処理後即時破棄   |
| CORS           | Firebase Storage のCORS設定、画像プロキシAPI               |
| 入力検証       | クライアント・サーバー両方でバリデーション                 |
| レートリミット | 分散レートリミット（Upstash Redis）によるAPI保護           |

### 4.3 可用性

| 項目         | 要件                              |
| ------------ | --------------------------------- |
| ホスティング | Vercel（自動スケーリング）        |
| データベース | Firebase Firestore（SLA 99.999%） |
| 障害時       | Vercelの自動リカバリに依存        |

### 4.4 運用・保守

| 項目       | 要件                                     |
| ---------- | ---------------------------------------- |
| デプロイ   | GitHub連携によるVercel自動デプロイ       |
| 環境分離   | 環境変数による開発/本番切り替え          |
| ログ       | Vercel Functions ログ + console.error    |
| エラー監視 | Sentryによるリアルタイムエラー監視・通知 |

---

## 5. 制約事項

| 項目             | 内容                                                                                                                   |
| ---------------- | ---------------------------------------------------------------------------------------------------------------------- |
| DARTSLIVE連携    | 公式なデータ連携手段が限られているため、サーバーサイドでの自動データ取得を実装。連携先の仕様変更時はメンテナンスが必要 |
| バレルデータ     | 外部サイトからの初期インポート。リアルタイム同期ではない                                                               |
| サーバーレス制約 | Vercel Serverless Functionsの制約（メモリ・実行時間）により、サーバーサイドブラウザ自動化の安定性に考慮が必要          |
| 個人開発         | 1名での開発・運用のため、サポート体制は限定的                                                                          |

---

## 6. 用語定義

| 用語             | 説明                                                             |
| ---------------- | ---------------------------------------------------------------- |
| バレル           | ダーツの金属製グリップ部分。重量・径・長さ・カットが主なスペック |
| シャフト         | バレルとフライトを繋ぐ棒状のパーツ                               |
| フライト         | ダーツ後部の羽。形状により飛び方が変わる                         |
| チップ           | ダーツ先端のポイント部分。ソフトダーツはプラスチック製           |
| Rating           | DARTSLIVEにおける総合実力指標                                    |
| PPD              | Points Per Dart。01ゲームの平均得点                              |
| MPR              | Marks Per Round。クリケットの1ラウンドあたりマーク数             |
| フライト（階級） | DARTSLIVEのレーティングに応じた階級（C〜SA）                     |
| CONDOR AXE       | シャフトとフライトが一体型のパーツ（特殊入力対応）               |
| 4スタンス理論    | 重心タイプ（A1/A2/B1/B2）に基づく身体理論                        |
| プレイヤーDNA    | スタッツから算出されるプレイヤーの特徴・傾向を表す指標           |
| XP               | 経験値。アプリ内アクティビティに応じて獲得                       |
